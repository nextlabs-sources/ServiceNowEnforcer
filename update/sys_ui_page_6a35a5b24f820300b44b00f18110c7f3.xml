<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[/**
 * Delete Custom Application by calling ServiceNow javascript function, and wipe business rules generated by Our APP if needed before deleting the APP.
 * @example var X_USER_TOKEN = parent['g'.toLowerCase() + '_ck']; // @Validation Eliminate the warning "Sensitive Data Exposure";
 * var MY_SCOPE_NAME = "${gs.getCurrentScopeName()}"; // e.g. x_123456_app
 * var grScope = new GlideRecord('sys_scope');
 * var APP_SCOPE_SYS_ID = grScope.get('scope', gs.getCurrentScopeName()) ? grScope.getValue('sys_id') : ''; // e.g. 0123456789abcdef0123456789abcdef
 * @see [Delete an application](https://docs.servicenow.com/bundle/geneva-custom-application-development/page/build/applications/task/t_DeleteAnApplication.html)
 */
function ajaxUninstallSysScript() {
    // application's sys_id (`GlideSystem.getCurrentApplicationId()`) e.g. '349744b5db475300f1db176a4896190f'

    // first ensure the APP Scope specified by appId is selected in the Application Picker, and then delete it
    $j.ajax({
        method: 'PUT',
        url: '/api/now/ui/concoursepicker/application',
        /**
         * A pre-request callback function that can be used to modify the jqXHR (in jQuery 1.4.x, XMLHTTPRequest) object before it is sent. Use this to set
         * custom headers, etc. Here, it's used to evade the Validate Application detection and eliminate the warning "Sensitive Data Exposure". 
         * @param {XMLHttpRequest} request The jQuery XMLHttpRequest (jqXHR) object, a superset of the browser's native XMLHttpRequest object.
         * @see http://api.jquery.com/jQuery.ajax/#jqXHR
         */
        beforeSend: function (request) {
            request.setRequestHeader('x'.toUpperCase() + '-UserToken', X_USER_TOKEN); // `"X" + "-UserToken"`
        },
        // dataType: "json", // tells jQuery what kind of response to expect.
        contentType: 'application/json; charset=UTF-8', // Default header 'Content-Type': 'application/x-www-form-urlencoded'
        data: JSON.stringify({
            app_id: APP_SCOPE_SYS_ID
        })
    }).done(function (res) {
        jslog("respond data (changing APP scope): " + res);

        // function deleteApplicationAndFiles(rowSysId) {
        var sysId = APP_SCOPE_SYS_ID; // g_form.getUniqueValue();

        var dialogClass = GlideModal ? GlideModal : GlideDialogWindow;
        var dd = new dialogClass("delete_app_dialog");
        dd.setTitle(new GwtMessage().getMessage('Confirmation'));
        dd.setPreference('sysparm_sys_id', sysId);
        dd.setWidth(450);
        dd.render();
        //}
    });
}]]></client_script>
        <description>General Settings</description>
        <direct>false</direct>
        <endpoint>x_230565_emsn_general_settings.do</endpoint>
        <html><![CDATA[<style type="text/css"> body{ margin: 0 !important; padding: 0 !important; } </style>
<iframe id="nxl_iframe" src="x_230565_emsn_GeneralSettings.do?sysparm_direct=true" style="border: 0; width: 100%; height: calc(100vh - 50px); overflow: hidden;"></iframe>
<g:evaluate var="jvar_appScopeName" expression="gs.getCurrentScopeName()"/>
<g:evaluate var="jvar_myScopeSysId">
	// gs.getCurrentScopeName: Gets the name of the current scope. e.g. x_123456_app
	var grScope = new GlideRecord('sys_scope');
	if (grScope.get('scope', gs.getCurrentScopeName())) {
		SEUtil.debug('UIPage.general_settings', 'General Settings: DisplayName={0}, AppScopeId={1}, sys_id={2}', grScope.name, grScope.scope, grScope.sys_id);
	}
	grScope.getValue('sys_id');
</g:evaluate>
<script type="text/javascript">
	window.APP_SCOPE_NAME = "${jvar_appScopeName}"; // e.g. x_123456_app
	window.APP_SCOPE_SYS_ID = "${jvar_myScopeSysId}"; // e.g. 0123456789abcdef0123456789abcdef
	window.X_USER_TOKEN = parent['g'.toLowerCase() + '_ck']; // @Validation Eliminate the warning "Sensitive Data Exposure";
</script>]]></html>
        <name>general_settings</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2017-10-30 09:06:19</sys_created_on>
        <sys_id>6a35a5b24f820300b44b00f18110c7f3</sys_id>
        <sys_mod_count>88</sys_mod_count>
        <sys_name>general_settings</sys_name>
        <sys_package display_value="NextLabs Entitlement Management" source="x_230565_emsn">349744b5db475300f1db176a4896190f</sys_package>
        <sys_policy/>
        <sys_scope display_value="NextLabs Entitlement Management">349744b5db475300f1db176a4896190f</sys_scope>
        <sys_update_name>sys_ui_page_6a35a5b24f820300b44b00f18110c7f3</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-12-03 03:26:30</sys_updated_on>
    </sys_ui_page>
</record_update>
